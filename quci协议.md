# 协议简介
&ensp;&ensp;&ensp;&ensp;Quic和HTTP协议一样采用流的概念来管理请求，但是它不会存在TCP头端阻塞的问题，因为本身不存在请求队列这一结构，也不会存在有序的流执行的顺序，自然也不会阻塞.

![alt text](./pic/quic/image.png)

- Quic支持快速握手，如果搭配TLS1.3协议，在之前建立过连接的情况下，只需要0个RTT即可开始发送数据。（HTTP/2需要3个RTT）
- 高效的差错恢复/无状态重试，以及可插拔的拥塞控制机制
- 可支持连接迁移技术
- 基于用户态实现，不需要更新操作系统即可更新Quic相关的内容。

# Quic的实现细节

  &ensp;&ensp;&ensp;&ensp;HTTP/2采用 IP地址+端口的 套接字来标记一个终端。但无论是IP地址还是端口号，可能都是会发生改变的，IP地址可能会因为我们的手机接入AP或者是WiFi就发生改变，或者是NAT路由的私有/公有地址映射发生改变。而端口可能因为端口被占用而发生改变。因此，用这种方式来标记一个处于稳定情况下的连接会话是可行的，但是一旦用户的网络环境频繁发生变化，那么将会无法维护一个稳定的TCP连接。

- 连接迁移

  而Quic抛弃了原有的传输层四元组（两个套接字），采用了一个Connection ID的形式来标记端。只要对方的IP地址不变（比如服务器），使用Connection ID，能够无缝地实现发送端的地址更改，在不需要建立连接的情况下，快速实现连接迁移。（因为不需要重新握手）

- 快速握手

  本义指的是QUIC不需要额外建立连接，初次握手需要1个RTT进行握手，而后续情况下，可以将连接的一些细节保存，直接复用上一次连接的数据实现0-RTT快速握手。

- 高效地恢复丢失

  TCP的SACK选项能够告诉发送方已经接收到的连续 Segment 的范围，方便发送方进行选择性重传。TCP最多只能提供30个字节的空间给sAck，而每一个sack Block的长度为8，Sack Option头部为2个字节，这样一来，30 - 2 = 28，28 / 8 = 3，最多只能提供3个完整的Block给sAck字段使用。而ACK帧可以同时提供256个Ack Block，在丢包率比较高的网络下，更多的 Sack Block 可以提升网络的恢复速度，减少重传量。

- 解决TCP序号二义性问题

  无论是正常还是重传的数据，其序号本身一定是单调递增的，这样一来即使是不同的序号也有可能数据内容是相同的（一个是正常帧，一个是超时重传帧），这样一来统计的超时时间是准确的。

- 安全性

  QUIC与TLS1.3配合，实现身份认证，密钥共享。而TLS1.3通过QUIC传递数据包。支持1-RTT完成TLS握手，在建立握手之后，最优情况下，支持0-RTT恢复握手，在建立连接时节省了往返时间。
